<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="#" />
  <title>INF1761 - T4</title>
</head>
<body onload="onLoad()" onkeypress="onKeyPress(event)">
  <canvas id="canvas" style="background-color: black" width="800" height="600"></canvas>
  <br>
  <button type="button" id="renderBtn" onclick="render1Pressed()">Iluminaçãoo por vértice</button>
  <button type="button" id="renderBtn2" onclick="render2Pressed()">Iluminaçãoo por fragmento</button>
  <br><br>

  <!--A versao precisa esta nessa posicao para evitar erros.-->
  <script id="vertexShaderSrc" type="notjs">#version 300 es

    in vec3 vertexPos;
    in vec3 vertexNormal;
    
    uniform vec3 color;

    uniform mat4 mv; 
    uniform mat4 nm; 
    uniform mat4 mvp;

    uniform vec4 leye;

    uniform vec3 amb; 
    uniform vec3 dif; 
    uniform vec3 spc; 
    uniform float shi; 

    out vec3 colorv;

    void main() {
      vec3 veye = vec3(mv*vec4(vertexPos, 1.0));
     
      vec3 light;
      if (leye.w == 0.0) light = normalize(vec3(leye));
      else                   light = normalize(vec3(leye) - veye); 

      vec3 normal = normalize(vec3(nm*vec4(vertexNormal, 0.0)));
      float ndotl = dot(normal, light);

      colorv =  vec3((0.2 + max(0.0, ndotl))*color);

      if ((ndotl > 0.0) && (shi > 0.0)) {
        vec3 refl = normalize(reflect(-light, normal));
        colorv += 1.0*pow(max(0.0, dot(refl, normalize(-veye))), shi);
      }

      gl_Position = mvp * vec4(vertexPos, 1.0);
    }

  </script>
  <!--A versao precisa esta nessa posicao para evitar erros.-->
  <script id="fragmentShaderSrc" type="notjs">#version 300 es
    precision mediump float;

    in vec3 colorv;
    out vec4 color;

    void main(void) {
        color = vec4(colorv, 1.0);
    }

  </script>

  <script id="vertexShaderSrc2" type="notjs">#version 300 es

    in vec3 vertexPos;
    in vec3 vertexNormal;

    uniform vec3 color;

    uniform mat4 mv; 
    uniform mat4 nm; 
    uniform mat4 mvp;

    uniform vec4 leye;

    out vec3 normal;
    out vec3 light;
    out vec3 ve;
    out vec3 colorv;

    void main() {
      vec3 veye = vec3(mv*vec4(vertexPos, 1.0));
    
      if (leye.w == 0.0) light = normalize(vec3(leye));
      else               light = normalize(vec3(leye) - veye); 

      normal = normalize(vec3(nm*vec4(vertexNormal, 0.0)));

      ve = normalize(-veye);

      colorv = color;

      gl_Position = mvp * vec4(vertexPos, 1.0);
    }

  </script>

    <!--A versao precisa esta nessa posicao para evitar erros.-->
    <script id="fragmentShaderSrc2" type="notjs">#version 300 es
      precision mediump float;
  
      in vec3 normal;
      in vec3 light;
      in vec3 ve;
      in vec3 colorv;

      uniform vec3 amb;
      uniform vec3 dif;
      uniform vec3 spc;
      uniform float shi;

      //a saida do fragment eh sempre um vec4
      out vec4 color;
  
      void main(void) {
        float ndotl = dot(normal, light);
        color =  vec4((0.2 + max(0.0, ndotl))*colorv, 1.0);
        
        if ((ndotl > 0.0) && (shi > 0.0)) {
          vec3 rl = normalize(reflect(-light, normal));
          color += 1.0*pow(max(0.0, dot(rl, ve)), shi);
        }
      }
  
    </script>



  <script src="./gl-matrix-min.js"></script>
  <script src="./utils.js"></script>
  <script src="./bunny.js"></script>
  <script src="./cube.js"></script>
  <script src="./sphere.js"></script>
  <script src="./rendering.js"></script>
  <script src="./arcball.js"></script>
</body>
</html>
